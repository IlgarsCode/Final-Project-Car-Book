<!DOCTYPE html>
<html
        xmlns:th="http://www.thymeleaf.org"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorate="~{layout}">
<head>
    <meta charset="UTF-8">
    <title>Ana səhifə</title>

    <style>
        .request-form .form-control {
            color: rgba(255,255,255,.9) !important;
        }
        .request-form select.form-control {
            color: rgba(255,255,255,.95) !important;
            background-color: rgba(255,255,255,.08) !important;
            border: 1px solid rgba(255,255,255,.25) !important;
        }
        .request-form select.form-control option {
            color: #111 !important;
            background: #fff !important;
        }
        .request-form select.form-control option[disabled] {
            color: #777 !important;
        }
    </style>
</head>
<body>
<div layout:fragment="content">

    <div class="hero-wrap ftco-degree-bg"
         th:style="'background-image: url(' + ${banner.photoUrl} + ')'"
         data-stellar-background-ratio="0.5">

        <div class="overlay"></div>

        <div class="container">
            <div class="row no-gutters slider-text justify-content-start align-items-center justify-content-center">
                <div class="col-lg-8 ftco-animate">
                    <div class="text w-100 text-center mb-md-5 pb-md-5">

                        <h1 class="mb-4" th:text="${banner.title}">Banner başlığı</h1>
                        <p style="font-size: 18px;" th:text="${banner.description}">Banner təsviri</p>

                        <a th:if="${banner.videoUrl != null}"
                           th:href="${banner.videoUrl}"
                           class="icon-wrap popup-vimeo d-flex align-items-center mt-4 justify-content-center">

                            <div class="icon d-flex align-items-center justify-content-center">
                                <span class="ion-ios-play"></span>
                            </div>

                            <div class="heading-title ml-5">
                                <span th:text="${banner.buttonText}">Videoya bax</span>
                            </div>
                        </a>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <section class="ftco-section ftco-no-pt bg-light">
        <div class="container">
            <div class="row no-gutters">
                <div class="col-md-12 featured-top">
                    <div class="row no-gutters">

                        <div class="col-md-4 d-flex align-items-center">
                            <!-- ✅ ƏVVƏL: /search -->
                            <!-- ✅ İNDİ: /axtaris -->
                            <form th:action="@{/axtaris}"
                                  th:object="${bookingForm}"
                                  method="post"
                                  class="request-form ftco-animate bg-primary">

                                <h2>Səfərini planlaşdır</h2>

                                <div class="form-group">
                                    <label class="label">Götürmə məntəqəsi</label>
                                    <select class="form-control" th:field="*{pickupLocationId}">
                                        <option value="" disabled selected hidden>Məntəqə seçin...</option>
                                        <option th:each="l : ${locations}"
                                                th:value="${l.id}"
                                                th:text="${l.name}">
                                        </option>
                                    </select>
                                    <small class="text-warning"
                                           th:if="${#fields.hasErrors('pickupLocationId')}"
                                           th:errors="*{pickupLocationId}"></small>
                                </div>

                                <div class="form-group">
                                    <label class="label">Təhvil məntəqəsi</label>
                                    <select class="form-control" th:field="*{dropoffLocationId}">
                                        <option value="" disabled selected hidden>Məntəqə seçin...</option>
                                        <option th:each="l : ${locations}"
                                                th:value="${l.id}"
                                                th:text="${l.name}">
                                        </option>
                                    </select>
                                    <small class="text-warning"
                                           th:if="${#fields.hasErrors('dropoffLocationId')}"
                                           th:errors="*{dropoffLocationId}"></small>
                                </div>

                                <div class="d-flex">
                                    <div class="form-group mr-2" style="flex:1;">
                                        <label class="label">Götürmə tarixi</label>
                                        <input type="date"
                                               id="pickupDate"
                                               class="form-control"
                                               th:field="*{pickupDate}"
                                               th:attr="min=${#temporals.format(#temporals.createNow(), 'yyyy-MM-dd')}">
                                        <small class="text-warning"
                                               th:if="${#fields.hasErrors('pickupDate')}"
                                               th:errors="*{pickupDate}"></small>
                                    </div>

                                    <div class="form-group ml-2" style="flex:1;">
                                        <label class="label">Təhvil tarixi</label>
                                        <input type="date"
                                               id="dropoffDate"
                                               class="form-control"
                                               th:field="*{dropoffDate}"
                                               th:attr="min=${#temporals.format(#temporals.createNow(), 'yyyy-MM-dd')}">
                                        <small class="text-warning"
                                               th:if="${#fields.hasErrors('dropoffDate')}"
                                               th:errors="*{dropoffDate}"></small>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="label">Götürmə saatı (ixtiyari)</label>
                                    <input type="time" class="form-control" name="pickupTime" placeholder="Saat">
                                </div>

                                <div class="form-group">
                                    <input type="submit" value="İndi avtomobil icarə et" class="btn btn-secondary py-3 px-4">
                                </div>

                                <div class="text-warning" th:if="${#fields.hasGlobalErrors()}">
                                    <div th:each="e : ${#fields.globalErrors()}" th:text="${e}"></div>
                                </div>

                            </form>
                        </div>

                        <div class="col-md-8 d-flex align-items-center">
                            <div class="services-wrap rounded-right w-100">
                                <h3 class="heading-section mb-4">İdeal avtomobili icarəyə götürməyin daha rahat yolu</h3>

                                <div class="row d-flex mb-4">
                                    <div class="col-md-4 d-flex align-self-stretch ftco-animate">
                                        <div class="services w-100 text-center">
                                            <div class="icon d-flex align-items-center justify-content-center">
                                                <span class="flaticon-route"></span>
                                            </div>
                                            <div class="text w-100">
                                                <h3 class="heading mb-2">Götürmə məntəqəsini seçin</h3>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-4 d-flex align-self-stretch ftco-animate">
                                        <div class="services w-100 text-center">
                                            <div class="icon d-flex align-items-center justify-content-center">
                                                <span class="flaticon-handshake"></span>
                                            </div>
                                            <div class="text w-100">
                                                <h3 class="heading mb-2">Ən uyğun təklifi seçin</h3>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-4 d-flex align-self-stretch ftco-animate">
                                        <div class="services w-100 text-center">
                                            <div class="icon d-flex align-items-center justify-content-center">
                                                <span class="flaticon-rent"></span>
                                            </div>
                                            <div class="text w-100">
                                                <h3 class="heading mb-2">Avtomobili rezerv edin</h3>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <p>
                                    <!-- ✅ Əgər CarController də AZ olacaqsa: /avtomobiller -->
                                    <a th:href="@{/Avtomobiller}" class="btn btn-primary py-3 px-4">
                                        Öz ideal avtomobilini seç
                                    </a>
                                </p>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </section>

    <script>
        (function () {
            const pickup = document.getElementById('pickupDate');
            const dropoff = document.getElementById('dropoffDate');
            if (!pickup || !dropoff) return;

            const pad = (n) => String(n).padStart(2, '0');
            const now = new Date();
            const todayStr = `${now.getFullYear()}-${pad(now.getMonth() + 1)}-${pad(now.getDate())}`;

            // əlavə təhlükəsizlik: min atributunu JS ilə də basırıq
            pickup.min = todayStr;
            dropoff.min = todayStr;

            function syncDropoffMin() {
                if (pickup.value) {
                    dropoff.min = pickup.value;

                    // dropoff pick-updan kiçikdirsə -> düzəlt
                    if (dropoff.value && dropoff.value < pickup.value) {
                        dropoff.value = pickup.value;
                    }
                } else {
                    dropoff.min = todayStr;
                }
            }

            pickup.addEventListener('change', syncDropoffMin);
            syncDropoffMin();
        })();
    </script>

    <section class="ftco-section ftco-no-pt bg-light">
        <div class="container">

            <div class="row justify-content-center">
                <div class="col-md-12 heading-section text-center ftco-animate mb-5">
                    <span class="subheading">Təklif etdiklərimiz</span>
                    <h2 class="mb-2">Seçilmiş avtomobillər</h2>
                </div>
            </div>

            <!-- boşdursa -->
            <div class="alert alert-info text-center"
                 th:if="${relatedCars == null or #lists.isEmpty(relatedCars)}">
                Hal-hazırda maşın yoxdur.
            </div>

            <div class="row" th:if="${relatedCars != null and !#lists.isEmpty(relatedCars)}">
                <div class="col-md-12">
                    <div class="carousel-car owl-carousel">

                        <div class="item" th:each="rc : ${relatedCars}">
                            <div class="car-wrap rounded ftco-animate">

                                <div class="img rounded d-flex align-items-end"
                                     th:style="'background-image: url(' + ${rc.imageUrl} + ');'">
                                </div>

                                <div class="text">
                                    <h2 class="mb-0">
                                        <!-- ✅ ƏVVƏL: /car/{slug} -->
                                        <!-- ✅ İNDİ: /Avtomobiller/{slug} -->
                                        <a th:href="@{'/Avtomobiller/' + ${rc.slug}}"
                                           th:text="${rc.title}">Maşın</a>
                                    </h2>

                                    <div class="d-flex mb-3">
                                        <span class="cat" th:text="${rc.brand}">Marka</span>
                                        <p class="price ml-auto">
                                            $<span th:text="${rc.dailyRate}">0</span> <span>/gün</span>
                                        </p>
                                    </div>

                                    <div class="d-flex mb-0 d-block">

                                        <!-- ✅ ƏVVƏL: /cart/add -->
                                        <!-- ✅ İNDİ: /sebet/elave-et -->
                                        <form th:action="@{/sebet/elave-et}" method="post" class="mr-1" style="margin:0;">
                                            <input type="hidden" name="carId" th:value="${rc.id}">
                                            <input type="hidden" name="rateType" value="DAILY">
                                            <input type="hidden" name="unitCount" value="1">

                                            <button type="submit" class="btn btn-primary py-2 mr-1">
                                                İndi bron et
                                            </button>
                                        </form>

                                        <!-- ✅ ƏVVƏL: /car/{slug} -->
                                        <!-- ✅ İNDİ: /Avtomobiller/{slug} -->
                                        <a th:href="@{'/Avtomobiller/' + ${rc.slug}}"
                                           class="btn btn-secondary py-2 ml-1">
                                            Ətraflı
                                        </a>
                                    </div>

                                </div>
                            </div>
                        </div>
                        <!-- /item -->

                    </div>
                </div>
            </div>

        </div>
    </section>


    <section class="ftco-section ftco-no-pt bg-light">
        <div class="container">

            <div class="row justify-content-center">
                <div class="col-md-12 heading-section text-center ftco-animate mb-5">
                    <span class="subheading">Təklif etdiklərimiz</span>
                    <h2 class="mb-2">Seçilmiş avtomobillər</h2>
                </div>
            </div>

            <!-- boşdursa -->
            <div class="alert alert-info text-center"
                 th:if="${relatedCars == null or #lists.isEmpty(relatedCars)}">
                Hal-hazırda maşın yoxdur.
            </div>

            <div class="row" th:if="${relatedCars != null and !#lists.isEmpty(relatedCars)}">
                <div class="col-md-12">
                    <div class="carousel-car owl-carousel">

                        <div class="item" th:each="rc : ${relatedCars}">
                            <div class="car-wrap rounded ftco-animate">

                                <div class="img rounded d-flex align-items-end"
                                     th:style="'background-image: url(' + ${rc.imageUrl} + ');'">
                                </div>

                                <div class="text">
                                    <h2 class="mb-0">
                                        <!-- ✅ ƏVVƏL: /car/{slug} -->
                                        <!-- ✅ İNDİ: /Avtomobiller/{slug} -->
                                        <a th:href="@{'/Avtomobiller/' + ${rc.slug}}"
                                           th:text="${rc.title}">Maşın</a>
                                    </h2>

                                    <div class="d-flex mb-3">
                                        <span class="cat" th:text="${rc.brand}">Marka</span>
                                        <p class="price ml-auto">
                                            $<span th:text="${rc.dailyRate}">0</span> <span>/gün</span>
                                        </p>
                                    </div>

                                    <div class="d-flex mb-0 d-block">

                                        <!-- ✅ ƏVVƏL: /cart/add -->
                                        <!-- ✅ İNDİ: /sebet/elave-et -->
                                        <form th:action="@{/sebet/elave-et}" method="post" class="mr-1" style="margin:0;">
                                            <input type="hidden" name="carId" th:value="${rc.id}">
                                            <input type="hidden" name="rateType" value="DAILY">
                                            <input type="hidden" name="unitCount" value="1">

                                            <button type="submit" class="btn btn-primary py-2 mr-1">
                                                İndi bron et
                                            </button>
                                        </form>

                                        <!-- ✅ ƏVVƏL: /car/{slug} -->
                                        <!-- ✅ İNDİ: /Avtomobiller/{slug} -->
                                        <a th:href="@{'/Avtomobiller/' + ${rc.slug}}"
                                           class="btn btn-secondary py-2 ml-1">
                                            Ətraflı
                                        </a>
                                    </div>

                                </div>
                            </div>
                        </div>
                        <!-- /item -->

                    </div>
                </div>
            </div>

        </div>
    </section>

    <section class="ftco-section">
        <div class="container">
            <div class="row justify-content-center mb-5">
                <div class="col-md-7 text-center heading-section ftco-animate">
                    <span class="subheading">Xidmətlər</span>
                    <h2 class="mb-3">Ən son xidmətlərimiz</h2>
                </div>
            </div>

            <div class="row">

                <div class="col-md-3"
                     th:each="service : ${services}">

                    <div class="services services-2 w-100 text-center">

                        <div class="icon d-flex align-items-center justify-content-center">
                            <span th:class="${service.icon}"></span>
                        </div>

                        <div class="text w-100">
                            <h3 class="heading mb-2"
                                th:text="${service.title}">
                                Xidmət başlığı
                            </h3>

                            <p th:text="${service.description}">
                                Xidmət təsviri
                            </p>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </section>

    <section class="ftco-section testimony-section bg-light">
        <div class="container">

            <div class="row justify-content-center mb-5">
                <div class="col-md-7 text-center heading-section">
                    <span class="subheading">Rəylər</span>
                    <h2 class="mb-3">Məmnun müştərilər</h2>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">

                    <!-- ƏSAS YER -->
                    <div class="carousel-testimony owl-carousel">

                        <div class="item"
                             th:each="t : ${testimonials}">

                            <div class="testimony-wrap rounded text-center py-4 pb-5">

                                <div class="text pt-4">
                                    <p class="mb-4"
                                       th:text="${t.comment}">
                                        Rəy mətni
                                    </p>

                                    <p class="name"
                                       th:text="${t.fullName}">
                                        Ad Soyad
                                    </p>

                                    <span class="position"
                                          th:text="${t.position}">
                                        Vəzifə
                                    </span>
                                </div>

                            </div>
                        </div>

                    </div>
                    <!-- /carousel -->

                </div>
            </div>

        </div>
    </section>

    <section class="ftco-section">
        <div class="container">
            <div class="row justify-content-center mb-5">
                <div class="col-md-7 heading-section text-center ftco-animate">
                    <span class="subheading">Bloq</span>
                    <h2>Son bloqlar</h2>
                </div>
            </div>

            <!-- boşdursa -->
            <div class="alert alert-info" th:if="${blogs == null or blogs.empty}">
                Blog tapılmadı.
            </div>

            <!-- dinamik 3 blog -->
            <div class="row d-flex" th:if="${blogs != null and !blogs.empty}">
                <div class="col-md-4 d-flex ftco-animate"
                     th:each="blog, stat : ${blogs}" th:if="${stat.index < 3}">
                    <div class="blog-entry justify-content-end w-100">

                        <!-- ✅ ƏVVƏL: /blog/{id} -->
                        <!-- ✅ İNDİ: /bloq/{id} -->
                        <a th:href="@{'/bloq/' + ${blog.id}}"
                           class="block-20"
                           th:style="'background-image: url(' + ${blog.imageUrl} + ');'">
                        </a>

                        <div class="text pt-4">
                            <div class="meta mb-3">
                                <div>
                                    <a th:href="@{'/bloq/' + ${blog.id}}"
                                       th:text="${#temporals.format(blog.createdAt, 'dd MMMM yyyy')}">
                                        29 Yanvar 2026
                                    </a>
                                </div>

                                <div>
                                    <!-- ✅ ƏVVƏL: /blog?page=1&search= -->
                                    <!-- ✅ İNDİ: /bloq?page=1&search= -->
                                    <a th:href="@{'/bloq?page=1&search='}"
                                       th:text="${blog.author}">
                                        Admin
                                    </a>
                                </div>

                                <div>
                                    <!-- ✅ ƏVVƏL: /blog/{id}#comments -->
                                    <!-- ✅ İNDİ: /bloq/{id}#comments -->
                                    <a th:href="@{'/bloq/' + ${blog.id} + '#comments'}" class="meta-chat">
                                        <span class="icon-chat"></span>
                                        <span th:text="${blog.commentCount}">0</span>
                                    </a>
                                </div>
                            </div>

                            <h3 class="heading mt-2">
                                <a th:href="@{'/bloq/' + ${blog.id}}"
                                   th:text="${blog.title}">
                                    Blog başlığı
                                </a>
                            </h3>

                            <p class="mb-0">
                                <a th:href="@{'/bloq/' + ${blog.id}}" class="btn btn-primary">
                                    Davamını oxu
                                </a>
                            </p>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="ftco-counter ftco-section img bg-light" id="section-counter">
        <div class="overlay"></div>
        <div class="container">
            <div class="row">
                <!-- Total Orders -->
                <div class="col-md-6 col-lg-3 justify-content-center counter-wrap ftco-animate">
                    <div class="block-18">
                        <div class="text text-border d-flex align-items-center">
                            <strong class="number"
                                    th:attr="data-number=${stats.totalOrders}">0</strong>
                            <span>Ümumi <br>Sifarişlər</span>
                        </div>
                    </div>
                </div>

                <!-- Total Cars -->
                <div class="col-md-6 col-lg-3 justify-content-center counter-wrap ftco-animate">
                    <div class="block-18">
                        <div class="text text-border d-flex align-items-center">
                            <strong class="number"
                                    th:attr="data-number=${stats.totalCars}">0</strong>
                            <span>Ümumi <br>Avtomobillər</span>
                        </div>
                    </div>
                </div>

                <!-- Happy Customers -->
                <div class="col-md-6 col-lg-3 justify-content-center counter-wrap ftco-animate">
                    <div class="block-18">
                        <div class="text text-border d-flex align-items-center">
                            <strong class="number"
                                    th:attr="data-number=${stats.happyCustomers}">0</strong>
                            <span>Məmnun <br>Müştərilər</span>
                        </div>
                    </div>
                </div>

                <!-- Total Testimonials -->
                <div class="col-md-6 col-lg-3 justify-content-center counter-wrap ftco-animate">
                    <div class="block-18">
                        <div class="text d-flex align-items-center">
                            <strong class="number"
                                    th:attr="data-number=${stats.totalTestimonials}">0</strong>
                            <span>Ümumi <br>Rəylər</span>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </section>
</div>
</body>
</html>